# Host-tuned codegen on mainstream desktop/server CPUs.
[target.'cfg(any(target_arch = "x86_64", target_arch = "aarch64"))']
rustflags = [
    "-C", "target-cpu=native",
    "-C", "llvm-args=-unroll-threshold=300",
    "-C", "llvm-args=-inline-threshold=275",
]

# Apple Silicon (macOS): let the linker strip unreachable sections/dylibs.
[target.aarch64-apple-darwin]
rustflags = [
    "-C", "link-arg=-Wl,-dead_strip",
    "-C", "link-arg=-Wl,-dead_strip_dylibs",
]

# Windows MSVC: use a faster linker and large address awareness
[target.x86_64-pc-windows-msvc]
rustflags = [
    "-C", "link-arg=/OPT:REF",      # eliminate unreferenced functions/data
    "-C", "link-arg=/OPT:ICF",      # fold identical COMDATs
]
